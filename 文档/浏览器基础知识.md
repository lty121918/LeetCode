# 浏览器基础知识

## 事件机制

### 事件触发的过程

+ 捕获阶段：事件从根节点流向目标节点，途中流经各个DOM节点，在各个节点上触发捕获事件，直到达到目标节点；
+ 目标阶段：事件到达目标节点时，就到了目标阶段，事件在目标节点上被触发；
+ 冒泡阶段：事件在目标节点上触发后，不会终止，一层层向上冒泡，回溯到根节点；

### 注册事件

通常我们使用 addEventListener注册事件，该函数的第三个参数是布尔值，默认是false，时间句柄在冒泡阶段执行。

> *element*.addEventListener(event, function, useCapture);

### 事件代理（事件委托）

JavaScript中常用绑定事件的常用技巧。顾名思义，“事件代理”即是把原本需要绑定在子元素的响应事件（click、keydown......）委托给父元素，让父元素担当事件监听的职务。事件代理的原理是DOM元素的事件冒泡。

事件代理的方式相较于直接给目标注册事件来说，有以下优点：

- 节省内存，管理的函数变少了。不需要为每个元素都添加监听函数；
- 不需要给子节点注销事件；
- 可以方便地动态添加和修改元素，不需要因为元素的改动而修改事件绑定；
- JavaScript和DOM节点之间的关联变少了，这样也就减少了因循环引用而带来的内存泄漏发生的概率。

### JS实现事件代理

Event对象提供了一个属性叫target，可以返回事件的目标节点，我们成为事件源，也就是说，target就可以表示为当前的事件操作的dom，但是不是真正操作dom。

```html
<body>
    <ul id="myLinks">
        <li id="goSomewhere">Go somewhere</li>
        <li id="doSomething">Do something</li>
        <li id="sayHi">Say hi</li>
    </ul>
    <script>
        var item1 = document.getElementById("goSomewhere");
        var item2 = document.getElementById("doSomething");
        var item3 = document.getElementById("sayHi");

        document.addEventListener("click", function(event) {
            var target = event.target;
            switch (target.id) {
                case "doSomething":
                    document.title = "事件委托";
                    break;
                case "goSomewhere":
                    location.href = "http://www.baidu.com";
                    break;
                case "sayHi":
                    alert("hi");
                    break;
            }
        })
    </script>
</body>

```



## 跨域

涉及面试题：什么是跨域？为什么浏览器要使用同源策略？你有几种方式可以解决跨域问题？了解预检请求嘛？

### 什么是跨域

因为浏览器出于安全考虑，有同源策略。也就是说，如果协议、域名或者端口有一个不同就是跨域，Ajax 请求会失败。

**那么是出于什么安全考虑才会引入这种机制呢？** 其实主要是用来防止 CSRF 攻击的。简单点说，CSRF 攻击是利用用户的登录态发起恶意请求。

**跨域并不是请求发不出去，请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了**。

也就是说，没有同源策略的情况下，A 网站可以被任意其他来源的 Ajax 访问到内容。如果你当前 A 网站还存在登录态，那么对方就可以通过 Ajax 获得你的任何信息。当然跨域并不能完全阻止 CSRF，因为请求毕竟是发出去了。

### 同源策略

最早由网景公司提出，是浏览器的一种安全策略。

同源：协议、域名、端口号必须相同。

### 解决跨域问题的方式

#### JSONP

有三个标签是允许跨域加载资源：

- `<img src=XXX>`
- `<link href=XXX>`
- `<script src=XXX>`

**利用 `<script>` 标签没有跨域限制的漏洞，网页可以得到从其他来源动态产生的 JSON 数据。JSONP请求一定需要对方的服务器做支持才可以。**

JSONP优点是简单兼容性好，可用于解决主流浏览器的跨域数据访问的问题。**缺点是仅支持get方法具有局限性,不安全可能会遭受XSS攻击。**

```js
<script src="http://domain/api?param1=a&param2=b&callback=jsonp"></script>
<script>
    function jsonp(data) {
    	console.log(data)
	}
</script>    
```



## 性能优化

### 优化的方向

+ 减少页面体积，提升网络加载  
  - 静态资源的压缩合并（JS 代码压缩合并、CSS 代码压缩合并、雪碧图）
  - 静态资源缓存（资源名称加 MD5 戳）
  - 使用 CDN 让资源加载更快

+ 优化页面渲染
  - CSS 放前面，JS 放后面
  - 懒加载（图片懒加载、下拉加载更多）
  - 减少DOM 查询，对 DOM 查询做缓存
  - 减少DOM 操作，多个操作尽量合并在一起执行（`DocumentFragment`）
  - 事件节流
  - 尽早执行操作（`DOMContentLoaded`）
  - 使用 SSR 后端渲染，数据直接输出到 HTML 中，减少浏览器使用 JS 模板渲染页面 HTML 的时间



## 从输入 URL 到页面加载完成的过程中都发生了什么事情？



> 参考链接：
>
> [浏览器事件机制中 事件触发的三个阶段 - DAVENEE - 博客园 (cnblogs.com)](https://www.cnblogs.com/fs0196/p/12685254.html)
>
> [从输入 URL 到页面加载完成的过程中都发生了什么事情？ - FEX (baidu.com)](http://fex.baidu.com/blog/2014/05/what-happen/)
>
> [JavaScript事件代理（事件委托）_越努力，越幸运！-CSDN博客_事件委托](https://blog.csdn.net/qq_38128179/article/details/86293394)